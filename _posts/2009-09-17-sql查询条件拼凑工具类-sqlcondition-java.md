---
id: 1929
title: 'SQL查询条件拼凑工具类: SQLCondition.java'
date: 2009-09-17T16:11:00+00:00
author: 刘长炯
layout: post
guid: http://www.beansoft.biz/?p=1929
permalink: '/2009/09/17/sql%e6%9f%a5%e8%af%a2%e6%9d%a1%e4%bb%b6%e6%8b%bc%e5%87%91%e5%b7%a5%e5%85%b7%e7%b1%bb-sqlcondition-java/'
views:
  - "3629"
original_post_id:
  - "1929"
categories:
  - OpenSource
---
package com.xxx.common.util; 

import static [**StringUtil**](http://www.blogjava.net/beansoft/archive/2009/05/24/277713.html).*; 

import java.util.Date; 

/**   
* MySQL/HQL 查询条件构建器(只支持and查询), 支持 like 通配符查询和忽略 NULL 参数.   
*   
* 智能拼参数: 当参数为空时, 会忽略此 and 条件. 调用方式见 main 方法的DEMO.   
*   
* @author 刘长炯   
* @date 2009-03-08   
*/   
public class SQLCondition {   
&#160;&#160;&#160; public final static String LIKE = "like";   
//&#160;&#160;&#160; public final static String GT = ">";   
//&#160;&#160;&#160; public final static String LT = "<";   
//&#160;&#160;&#160; public final static String EQ = "=";   
//&#160;&#160;&#160; public final static String EQIGCASE = "EC";   
//&#160;&#160;&#160; public final static String GTE = ">=";   
//&#160;&#160;&#160; public final static String LTE = "<="; 

&#160;&#160;&#160; public final static String ParamType_Number = "NUM";//数字类型   
&#160;&#160;&#160; public final static String ParamType_String = "STR";//字符串类型   
&#160;&#160;&#160; public final static String ParamType_Datetime = "DATE";//日期类型   
&#160;&#160;&#160; private String condition = "";//查询条件   
&#160;&#160;&#160; private String table;// 表名   
&#160;&#160;&#160; // 此方法演示了如何调用   
&#160;&#160;&#160; public static void main(String[] args) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; SQLCondition cond = new SQLCondition();   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.setTable("表1 bill");// 可选设置, 用于生成 FROM 和 COUNT 语句   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.add("bill.providername", "like", "value");   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.add("bill.2", "=", "value2");   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.add("bill.3", "=", null);// 被忽略   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.add("bill.4", "=", "");// 被忽略   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.addNum("数字列", "=", "3");   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.addNum("数字列", ">", "4");   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.addDate("日期列", "<=", "2009", "2");   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(cond.getCondition());// 条件语句   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(cond.getFromSQL());//生成的 FROM 语句   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(cond.getCountSQL());// 生成的 COUNT 语句   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; /* 输出为:   
WHERE bill.providername LIKE &#8216;%value%&#8217; AND bill.2 = &#8216;value2&#8217; AND 数字列 = 3 AND 数字列 > 4 AND 日期列 <= &#8216;2009-02&#8217;   
FROM 表1 bill WHERE bill.providername LIKE &#8216;%value%&#8217; AND bill.2 = &#8216;value2&#8217; AND 数字列 = 3 AND 数字列 > 4 AND 日期列 <= &#8216;2009-02&#8217;   
SELECT COUNT(*) FROM 表1 bill WHERE bill.providername LIKE &#8216;%value%&#8217; AND bill.2 = &#8216;value2&#8217; AND 数字列 = 3 AND 数字列 > 4 AND 日期列 <= &#8216;2009-02&#8217; 

&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; cond.clear();// 清空现有参数列表, 然后可重用此对象 

&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 添加比较条件, 指定所有参数.   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param value 参数值   
&#160;&#160;&#160;&#160; * @param type 类型   
&#160;&#160;&#160;&#160; * @param allowEmpty 是否允许为空   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void add(String column, String operator, Object value, String type, boolean allowEmpty) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(!allowEmpty && ( value == null || "".equals(value))) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(type.equals(ParamType\_String) || type.equals(ParamType\_Datetime)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(value instanceof String) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; value = replaceSql((String)value);   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(LIKE.equalsIgnoreCase(operator)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(type.equals(ParamType_Datetime)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition += column&#160; + " LIKE &#8216;"+ value +"%&#8217; AND ";// 缩小查询范围   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition += column&#160; + " LIKE &#8216;%"+ value +"%&#8217; AND ";   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // TODO 更多查询操作符支持   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition += column&#160; + " " + operator + " &#8216;"+ value +"&#8217; AND ";   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // 数字类型   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; else if(type.equals(ParamType_Number)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(LIKE.equalsIgnoreCase(operator)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition += column&#160; + " = "+ " " + value +" AND ";   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition += column&#160; + " " + operator + " " + value +" AND ";   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 添加字符串比较条件   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param value 取值   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void add(String column, String operator, String value) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; add(column, operator, value, ParamType_String, false);   
&#160;&#160;&#160; }   
&#160;&#160;&#16
  
0; /**   
&#160;&#160;&#160;&#160; * 添加数字比较条件   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param value 取值   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void addNum(String column, String operator, String value) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(!isNumeric(value)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; add(column, operator, value, ParamType_Number, false);   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 将给定的日期字符串作为日期参与比较.   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param value 日期字符串   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void addDate(String column, String operator, String value) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; add(column, operator, value, ParamType_Datetime, false);   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 将年月格式的日期格式化后作为比较字符串.   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param year 年   
&#160;&#160;&#160;&#160; * @param month 月   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void addDate(String column, String operator, String year, String month) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(isEmpty(year) || isEmpty(month)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // 日期匹配, 月份统一显示为2位   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(month.length() == 1) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; month = "0" + month;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; add(column, operator, year + "-" + month, ParamType_Datetime, false);   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 将日期固定格式化后作为比较字符串.   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param date   
&#160;&#160;&#160;&#160; * @param datePattern 日期格式化字符串   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void addDate(String column, String operator, Date date, String datePattern) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(date == null) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; String value = formatDate(date, datePattern);   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; addDate(column, operator, value);   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 将日期作为 YYYY-MM-dd 的格式加入比较字符串.   
&#160;&#160;&#160;&#160; * @param column 列名   
&#160;&#160;&#160;&#160; * @param operator 操作符   
&#160;&#160;&#160;&#160; * @param date   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void addDate(String column, String operator, Date date) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(date == null) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; addDate(column, operator, date, "YYYY-MM-dd");   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 得到 From 语句和条件.   
&#160;&#160;&#160;&#160; * @return FROM ${table} where &#8230;.   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public String getFromSQL() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return "FROM " + getTable() + getCondition();   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 得到计算 COUNT 语句和条件.   
&#160;&#160;&#160;&#160; \* @return SELECT COUNT(\*) FROM ${table} where &#8230;.   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public String getCountSQL() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return "SELECT COUNT(*) FROM " + getTable() + getCondition();   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 获得查询条件.   
&#160;&#160;&#160;&#160; * @return 包含 Where 条件的语句   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public String getCondition() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // 防止多次调用出现多个where   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(condition.indexOf("WHERE") != -1) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return condition;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; // 去掉末尾的"and "并加入where语句   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(!isEmpty(condition)) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(condition.substring(condition.length()-4, condition.length()).equals("AND ") ){   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition = condition.substring(0, condition.length()-4);   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }   
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition = " WHERE " + condition;   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; } 

&#160;&#160;&#160;&#160;&#160;&#160;&#160; return condition;   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /*\* 清空查询条件 \*/   
&#160;&#160;&#160; public void clear() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; condition = "";   
&#160;&#160;&#160; }   
&#160;&#160;&#160; /*\* 返回查询条件作为对象描述 \*/   
&#160;&#160;&#160; public String toString() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return getCondition();   
&#160;&#160;&#160; } 

&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 得到表名   
&#160;&#160;&#160;&#160; * @return   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public String getTable() {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return table;   
&#160;&#160;&#160; } 

&#160;&#160;&#160; /**   
&#160;&#160;&#160;&#160; * 设置表名/实体名   
&#160;&#160;&#160;&#160; * @param table   
&#160;&#160;&#160;&#160; */   
&#160;&#160;&#160; public void setTable(String table) {   
&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.table = table;   
&#160;&#160;&#160; } 

}

转载请注明：[WebLogic Android 博客](http://www.beansoft.biz) &raquo; [SQL查询条件拼凑工具类: SQLCondition.java](http://www.beansoft.biz/2009/09/17/sql%e6%9f%a5%e8%af%a2%e6%9d%a1%e4%bb%b6%e6%8b%bc%e5%87%91%e5%b7%a5%e5%85%b7%e7%b1%bb-sqlcondition-java/)