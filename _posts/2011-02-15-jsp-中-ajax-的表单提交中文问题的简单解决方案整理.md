---
id: 1746
title: 'JSP 中 AJAX 的表单提交中文问题的简单解决方案[整理]'
date: 2011-02-15T18:37:30+00:00
author: 刘长炯
layout: post
guid: http://www.beansoft.biz/?p=1746
permalink: '/2011/02/15/jsp-%e4%b8%ad-ajax-%e7%9a%84%e8%a1%a8%e5%8d%95%e6%8f%90%e4%ba%a4%e4%b8%ad%e6%96%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%ae%80%e5%8d%95%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%e6%95%b4%e7%90%86/'
views:
  - "6287"
original_post_id:
  - "1746"
image: /wp-content/uploads/2012/09/o_ajaxFormer.png
categories:
  - AJAX/JavaScript
---
作者: 刘长炯 BeanSoft@126.com

在用 AJAX 开发的过程中, 不可避免的会遇到中文问题. 很多原来可以通过表单进行 POST 提交的字符, 到了用 AJAX 实现的时候, 就会出现烦人的乱码和丢特殊字符的现象. 另外服务器端返回值如何解析, 也是一个很烦人的问题. 本文将就个人的一点实践经验作出总结, 并给出一个尽量简单可行, 复用性高的方案. 目的不是替代你喜欢的 AJAX 框架, 而是希望帮助您理解和处理可能遇到的问题. 

开始之前: 首先一个问题就是通常 XMLHttpRequest 默认的编码都是UTF-8的, 所以我们建议所有页面, 客户端和服务器端都使用 UTF-8 作为编码. 

<span style="font-weight:bold;">1. base64 encode 和 decode</span>   
&#160;&#160;&#160; 这个方案依赖于 JavaScript 实现的 base64 编码/解码方法, 在客户端发送参数的时候用 base64 进行编码, 服务器端通过 base64 进行解码后还原出原来的字符, 这个解决方案可以满足需要, 但是有个问题就是一是增加了客户端代码量, 还有个大问题就是编码后的内容比原始内容会大很多, 另外如果找到的 base64 JS 算法不够标准的话, 服务器端就无法还原原来的值了. 现在网上有很多种 base64 的 JS 实现代码, 例如如下的一个算法实现: 

<span style="background-color:rgb(204,204,255);"><HTML></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><HEAD></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><TITLE>Base64</TITLE></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><script language=javascript></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">var base64DecodeChars = new Array(</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">-1, 0, 1, 2, 3,&#160; 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">-1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">function base64encode(str) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var out, i, len;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var c1, c2, c3;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">len = str.length;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">i = 0;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out = "";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">while (i < len) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c1 = str.charCodeAt(i++) & 0xff;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(i == len)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">{</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(c1 >> 2);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt((c1 & 0x3) << 4);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += "==";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c2 = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(i == len)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">{</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(c1 >> 2);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt((c2 & 0xF) << 2);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += "=";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c3 = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(c1 >> 2);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >>6));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += base64EncodeChars.charAt(c3 & 0x3F);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">function base64decode(s<br /> tr) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var c1, c2, c3, c4;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var i, len, out;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">len = str.length;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">i = 0;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out = "";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">while (i < len) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">/* c1 */</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">do {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c1 = base64DecodeChars[str.charCodeAt(i++) & 0xff];</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} while(i < len && c1 == -1);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c1 == -1)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">/* c2 */</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">do {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c2 = base64DecodeChars[str.charCodeAt(i++) & 0xff];</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} while(i < len && c2 == -1);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c2 == -1)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">/* c3 */</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">do {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c3 = str.charCodeAt(i++) & 0xff;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c3 == 61)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c3 = base64DecodeChars[c3];</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} while(i < len && c3 == -1);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c3 == -1)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">/* c4 */</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">do {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c4 = str.charCodeAt(i++) & 0xff;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c4 == 61)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c4 = base64DecodeChars[c4];</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} while(i < len && c4 == -1);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if(c4 == -1)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(((c3 & 0x03) << 6) | c4);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">function utf16to8(str) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var out, i, len, c;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out = "";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">len = str.length;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">for(i = 0; i < len; i++) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c = str.charCodeAt(i);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">if ((c >= 0x0001) && (c <= 0x007F)) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += str.charAt(i);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} else if (c > 0x07FF) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">} else {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">}</span>   
<span style="background-color:rgb(204,204,255);">function utf8to16(str) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var out, i, len, c;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var char2, char3;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out = "";</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">len = str.length;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">i = 0;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">while (i < len) {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">c = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">switch(c >> 4)</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">{</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">// 0xxxxxxx</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += str.charAt(i-1);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">case 12: case 13:</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">// 110x xxxx 10xx xxxx</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">char2 = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">case 14:</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">// 1110 xxxx 10xx xxxx 10xx xxxx</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">char2 = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">char3 = str.charCodeAt(i++);</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">out += String.fromCharCode(((c & 0x0F) << 12) |</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">((char2 & 0x3F) << 6) |</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">((char3 & 0x3F) << 0));</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">break;</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">return out;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">}</span>     <br style="background-color:rgb(204,204,255);" /><br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">function doit() {</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">var f = document.f</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">f.output.value = base64encode(utf16to8(f.source.value))</span> <br style="background-color:rgb(204,204,255);" /> <span style="background-color:rgb(204,204,255);">f.decode.value = utf8to16(base64decode(f.output.value))</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">}</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></script></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></HEAD></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><BODY></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><H1>Base64</H1></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><FORM NAME="f"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">原码& lt;BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><TEXTAREA NAME="source" ROWS=4 COLS=60 WRAP="soft"></TEXTAREA><BR><BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">Base64 encode<BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><TEXTAREA NAME="output" ROWS=4 COLS=60 WRAP="soft"></TEXTAREA><BR><BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">Base64 decode<BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><TEXTAREA NAME="decode" ROWS=4 COLS=60 WRAP="soft"></TEXTAREA><BR><BR></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><INPUT TYPE=BUTTON VALUE="转换" ONCLICK="doit()"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></FORM></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></BODY></span> 

在每个表单值被提交之前调用 base64encode, 然后在服务器端调用 base64 解码器即可.   
<span style="background-color:rgb(255,255,204);">在 JSP 中可以通过这样做来实现:</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; sun.misc.BASE64Decoder base64decoder = new sun.misc.BASE64Decoder();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; byte[] data = base64decoder.decodeBuffer(request.getParameter("input"));</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; String result = new String(data, "UTF-8");// 注意建议这里指定字符集来还原到原来的字符串</span> 

在这种情况下服务器端返回的字符也可以通过先 base64 编码的方式传递到客户端, 客户端之后调用 JS 形式的解码器即可还原到原来的字符串. 服务器端可以使用 sun.misc.BASE64Encoder (不要用 java.netURLEncoder). 
      
<br style="font-weight:bold;" /><span style="font-weight:bold;">2.使用 JS 自带的 escape() & encodeURI() & encodeURIComponent()</span> 

escape() & encodeURI() & encodeURIComponent()这三个函数都可以用来对URI进行encode或过滤特殊字符（#/$&+=?/等）。我的经验是最好用encodeURIComponent()（需要IE 5.5以上，FireFox当然没问题），因为对UTF-8支持比较好，不会遇到中文乱码问题，否则还需要进行编码转换，很麻烦的。使用其它两个函数都会发生丢失特殊字符的问题,例如空格变+号或者空格,引号,&=?等丢失的问题, 至少使用 JSP 作为服务器端的话会发生这种情况, 有兴趣的朋友可以将本文最后的例子代码中的编码部分修改后做个测试.

下面是MSDN上对这三个函数的解释：

**escape(charString)**

<blockquote style="margin-right:0;background-color:rgb(192,192,192);">
  <p>
    The escape method returns a string value (in Unicode format) that contains the contents of charstring. All spaces, punctuation, accented characters, and any other non-ASCII characters are replaced with %xx encoding, where xx is equivalent to the hexadecimal number representing the character. For example, a space is returned as "%20."
  </p>
  
  <p>
    Characters with a value greater than 255 are stored using the %uxxxx format.
  </p>
  
  <p>
    Note&#160;&#160; The escape method should not be used to encode Uniform Resource Identifiers (URI). Use encodeURI and encodeURIComponent methods instead.
  </p>
  
  <p>
    <a href="http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthescape.asp">http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthescape.asp</a>
  </p>
</blockquote>

<p style="background-color:transparent;">
  <strong> encodeURI(URIString)</strong>
</p>

<blockquote style="margin-right:0;background-color:rgb(192,192,192);">
  <p>
    The encodeURI method returns an encoded URI. If you pass the result to decodeURI, the original string is returned. The encodeURI method does not encode the following characters: ":", "/", ";", and "?". Use encodeURIComponent to encode these characters.
  </p>
  
  <p>
    <a href="http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthfencodeuri.asp">http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthfencodeuri.asp</a>
  </p>
</blockquote>

**encodeURIComponent(encodedURIString)**

<blockquote style="margin-right:0;">
  <p style="background-color:rgb(204,204,204);">
    The encodeURIComponent method returns an encoded URI. If you pass the result to decodeURIComponent, the original string is returned. Because the encodeURIComponent method encodes all characters, be careful if the string represents a path such as /folder1/folder2/default.html. The slash characters will be encoded and will not be valid if sent as a request to a web server. Use the encodeURI method if the string contains more than a single URI component.
  </p>
  
  <p style="background-color:rgb(204,204,204);">
    <a href="http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthencodeuricomponent.asp">http://msdn.microsoft.com/library/en-us/script56/html/js56jsmthencodeuricomponent.asp</a>
  </p>
</blockquote>

<span style="font-weight:bold;">3. 使用一个简便的客户端数据解析方案 </p> 

<p>
  </span>最偷懒的办法就是返回一段 HTML 显示出来了. 至于如果是想带一些数据, 解析处理的话, 方案很多, 利用 XML 啊, JSON 啊什么的不一而足. 我这里呢就给出一个相当简便的方案: 使用 JS 内置的 eval 方法来解析. 这个方案是在帮助一个同事想最快的已最短的代码解析返回的对象的多个变量的时候提出的.
</p>

<p>
  服务器端返回一个字符串: <br /><span style="background-color:rgb(255,255,204);">var _dataObject = {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160; username : "beansoft",</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; age : 24</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">};</span> <br style="background-color:rgb(255,255,204);" /> <br />客户端在得到这个字符串后可以通过下面一段代码搞定: <br /><span style="background-color:rgb(204,204,255);">var responseText = xmlhttp.responseText;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">eval(responseText);</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">alert("_dataObject.username=" + _dataObject.username);</span>
</p>

<p>
  好了, 解析出来了! <br />如果要传递多个变量呢, 就用 var _dataObject1, var _dataObject2&#8230;这样就可以了, 客户端就依次是 _dataObject1.username, _dataObject2.username&#8230;
</p>

<p>
  等等: 我的变量里写了特殊字符怎么办? 例如我用的字符串是 &#8216;abc"&#8221;, 这时候我不得不抛出杀手锏了, 这就是用 Java 实现的 escape(), unescape() 方法, 其实本例中只需要 escape() 的 Java 版本就可以了(这个方案也帮助另一个同事解决了从JSP端传递的变量含有&#8217;号结果导致客户端没法显示的问题):
</p>

<p>
  <span style="background-color:rgb(255,255,204);">&#160;&#160;&#160; public static String escape(String src) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; int i;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; char j;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; StringBuffer tmp = new StringBuffer();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.ensureCapacity(src.length() * 6);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; for (i = 0; i < src.length(); i++) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; j = src.charAt(i);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (Character.isDigit(j) || Character.isLowerCase(j)</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; || Character.isUpperCase(j))</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(j);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else if (j < 256) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append("%");</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (j < 16)</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#<br /> 160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append("0");</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(Integer.toString(j, 16));</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append("%u");</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(Integer.toString(j, 16));</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; return tmp.toString();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160; public static String unescape(String src) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; StringBuffer tmp = new StringBuffer();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.ensureCapacity(src.length());</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; int lastPos = 0, pos = 0;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; char ch;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; while (lastPos < src.length()) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pos = src.indexOf("%", lastPos);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (pos == lastPos) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (src.charAt(pos + 1) == &#8216;u&#8217;) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ch = (char) Integer.parseInt(src</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .substring(pos + 2, pos + 6), 16);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(ch);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; lastPos = pos + 6;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ch = (char) Integer.parseInt(src</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .substring(pos + 1, pos + 3), 16);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(ch);</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; lastPos = pos + 3;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (pos == -1) {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(src.substring(lastPos));</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; lastPos = src.length();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmp.append(src.substring(lastPos, pos));</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; lastPos = pos;</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; return tmp.toString();</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160; }</span> <br /><span style="font-weight:bold;"> <br /></span>这样, 在服务器端的时候可以变成: <br /><span style="background-color:rgb(255,255,204);"><%</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">String username = "&#8217;abc"&#8221;";</span><span style="color:rgb(0,102,0);"><span style="background-color:rgb(255,255,204);">// 其实这个普通字符串转换成 Java 语言中的字符串也有工具可以用的, 例如本人开发的 Native2JavaString, 改日再讲.</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">%></span> <br /></span><span style="font-weight:bold;"></span><span style="background-color:rgb(255,255,204);">var _dataObject = {</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160; username : "<%=escape(username)%>",</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">&#160;&#160;&#160;&#160;&#160;&#160;&#160; age : 24</span> <br style="background-color:rgb(255,255,204);" /><span style="background-color:rgb(255,255,204);">};</span> <br />客户端呢, 就可以简单的来JS自带的 unescape() 函数来取出原来的字符串: <br /><span style="background-color:rgb(204,204,255);">var responseText = xmlhttp.responseText;</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">eval(responseText);</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">alert("_dataObject.username=" + <span style="font-weight:bold;">unescape</span>(_dataObject.username));</span> <br />就是服务器端用 Java 写的 escape(), 客户端呢就用 JS 自带的 unescape().
</p>

<p>
  <span style="font-weight:bold;">4. 实例代码</span> <br />好了, 说了这么多, 就推出个人的解决方案吧. 简单的讲就是我写了一个脚本对象 AjaxFormer, 使用的是encodeURIComponent() 来自动的将原来的 POST/GET 方式的提交代码自动的转换成 AJAX 的方式, 而且仍然保持原来的 GET/POST 模式不便.
</p>

<p>
  <span style="background-color:rgb(255,204,102);">/**</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> * @constructor</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> * This is a ajax form helper class.</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> *</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> * @param form &#8211; the document form</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> * @param resultDivId &#8211; the result div id</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);"> */</span> <br style="background-color:rgb(255,204,102);" /><span style="background-color:rgb(255,204,102);">function AjaxFormer (form, resultDivId);</span>
</p>

<p>
  构造器的第一个参数是个 form 对象, 第二个是个可选的结果 DIV 对象, 也就是说你可以指定服务器端返回的 HTML 代码显示的地方, 如果保持为空的话, 那么返回的 HTML 会被附加到文档的末尾. 本对象有一个名字为 ajaxSubmitForm() 的方法来自动的遍历所有表单元素, 然后将结果拼成一个字符串, 最后根据原来的表单的提交方式(get/post)来自动再客户端用 AJAX 模拟提交这个表单到原来的表单的 action 属性所指定的页面中去.
</p>

<p>
  用法示例: <br /><span style="background-color:rgb(204,204,255);"><html></span> <br style="background-color:rgb(204,204,255);" /> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><head></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><title>AJAX Form Submit Test</title></span> <br style="background-color:rgb(204,204,255);" /><span style="font-weight:bold;color:rgb(255,0,0);background-color:rgb(204,204,255);"><script src=&#8217;ajax_common.js&#8217;></script></span> <br style="background-color:rgb(204,204,255);" /> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></head></span> <br style="background-color:rgb(204,204,255);" /> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><body></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><h3>AJAX Form Submit Test</h3></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">Fill the form and then click submit</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><form method="POST" id="form1" name="form1" </span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">action="form_action.jsp"</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"><span style="font-weight:bold;color:rgb(255,0,0);">onSubmit="former.ajaxSubmitForm();return false;"</span>></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <p><input type="hidden" name="hidden1" value="hiddenValue"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; text:<input type="text" name="textf&1" size="20" value="text1"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; checkbox:<input type="checkbox" name="checkbox1" value="ON" checked></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; radio:<input type="radio" value="V1" checked name="radio1"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; select:<select size="1" name="select1"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <option selected value="option1">D1</option></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; </select></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <br></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <br></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <input type="submit" name="B1" value="submit"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; <input type="reset" name="B2" value="reset"></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);">&#160;&#160;&#160; </p></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></form></span> <br style="background-color:rgb(204,204,255);" /> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></span><span style="background-color:rgb(204,204,255);"></span><span style="background-color:rgb(204,204,255);"><script type="text/javascript"></span> <br style="background-color:rgb(204,204,255);" /><span style="font-weight:bold;color:rgb(255,0,0);background-color:rgb(204,204,255);">var former = new AjaxFormer($(&#8216;form1&#8217;));</span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></script></span> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></body></span> <br style="background-color:rgb(204,204,255);" /> <br style="background-color:rgb(204,204,255);" /><span style="background-color:rgb(204,204,255);"></html> </p> 
  
  <p>
    </span>红色的字体就是您从一个非 AJAX 的表单提交改变成一个 AJAX 的表单提交所需要做的工作, 看上去够简单吧?
  </p>
  
  <p>
    运行时的效果如图所示: <br /><img alt="http://www.blogjava.net/images/blogjava_net/beansoft/18680/o_ajaxFormer.png" src="http://www.blogjava.net/images/blogjava_net/beansoft/18680/o_ajaxFormer.png" />
  </p>
  
  <p>
    下载本文的源码:&#160;
  </p>
  
  <p>
    <a href="http://www.blogjava.net/Files/beansoft/AJAXFormer.zip">AJAXFormer.zip</a>4KB
  </p>
  
  <p>
    将源码解压缩到JSP服务器的任意目录下即可, 例如 $TOMCAT_HOMEwebappsROOT 下, 然后在浏览器里键入: <br />http://localhost:8080/ajax_form_submit.htm <br />. <br />本文参考了网上多篇文章并综合了自己的实践, 最后的源码是本人原创的作品, 如果使用转载请注明出处. 在此就不再一一指出并道谢了.
  </p>
  
  <p>
    作者: <a href="mailto:beansoft@126.com">beansoft@126.com</a> 2006.12.25
  </p>
  
  <p>
    转载请注明：<a href="http://www.beansoft.biz">WebLogic Android 博客</a> &raquo; <a href="http://www.beansoft.biz/2011/02/15/jsp-%e4%b8%ad-ajax-%e7%9a%84%e8%a1%a8%e5%8d%95%e6%8f%90%e4%ba%a4%e4%b8%ad%e6%96%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%ae%80%e5%8d%95%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%e6%95%b4%e7%90%86/">JSP 中 AJAX 的表单提交中文问题的简单解决方案[整理]</a>
  </p>