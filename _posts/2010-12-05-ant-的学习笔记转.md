---
id: 1480
title: 'ant 的学习笔记[转]'
date: 2010-12-05T19:23:59+00:00
author: 刘长炯
layout: post
guid: http://www.beansoft.biz/?p=1480
permalink: '/2010/12/05/ant-%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%e8%bd%ac/'
views:
  - "8089"
original_post_id:
  - "1480"
categories:
  - Apache开源产品
---
来源: <http://grid.tsinghua.edu.cn/home/liulk/wiki/computer/AntStudy.html>

<span class="Apple-style-span" style="word-spacing:0;font:medium simsun;text-transform:none;color:rgb(0,0,0);text-indent:0;white-space:normal;letter-spacing:normal;border-collapse:separate;orphans:2;widows:2;"><span class="Apple-style-span" style="font-size:14px;line-height:25px;font-family:&#039;"> </p> 

<h1 id="top" style="color:rgb(0,79,55);border-bottom:rgb(0,79,55) 3px solid;background-color:rgb(217,231,226);margin:0 -100px 10px;padding:22px 0 16px 60px;">
  &#160;&#160; ant 的学习笔记
</h1>

<h2 style="border-right:rgb(102,102,102) 2px solid;border-top:rgb(0,102,153) 1px solid;border-left:rgb(0,153,204) 1px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(210,233,255);margin:20px -30px 10px;padding:0 5px;">
  &#160; Ant笔记
</h2>

<h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
  Ant处理方式
</h3>

<p>
  ant从的build文件从本质上来说,就是一个特殊的xml文件,从有真正意义的结果上来说(忽略掉里面的<a class="nonexistent" style="font-weight:bold;color:rgb(153,0,255);text-decoration:none;" href="mailto:liulikun@gmail.com">DataType</a>定义),这个树只有两层.以为根结点,里面是target元素,target里面是task元素.ant再处理的时候是对于不同的level是采用不同的处理方式.对于project level来说,ant采用宽度优先遍历的方式,搜索所有的target元素,并对他们进行登记(以便后面处理),同时处理所有的非target元素,主要是一些property元素,和<a class="nonexistent" style="font-weight:bold;color:rgb(153,0,255);text-decoration:none;" href="mailto:liulikun@gmail.com">DataType</a>元素.对于target level,ant采用的深度优先遍历的方式,处理所有的task元素.一边遍历,一边处理.正是因此:
</p>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    ant会抛出两类错误:project level error和 target level error.
  </li>
  <li style="margin-bottom:5px;">
    对于target level,task之间的顺序就显得很重要了
  </li>
</ul>

<h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
  ant的两种错误类型
</h3>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    project level error
  </li>
  <li style="margin-bottom:5px;">
    target level error<br /> <h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
      ant如何处理错误
    </h3>
  </li>
  
  <li style="margin-bottom:5px;">
    再缺省的情况下,ant在遇到第一个错误的时候就会停下
  </li>
  <li style="margin-bottom:5px;">
    ant没有回滚策略.这一点应该特别注意,因为ant在处理target level的时候是一边解析一边处理的,之前没有任何的语法检查过程,如果你的build.xml文件存在target类型的错误,就很可能使得你的工程已经处理了一部分的时候,ant突然发现一个错误而停止.这时候,很可能你的工程就处于一种不确定的状态.
  </li>
  <li style="margin-bottom:5px;">
    你可以通过写listener的方式来扩展ant的错误处理.
  </li>
</ul>

<h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
  ant的数据类型
</h3>

<h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
  数据类型的优先级
</h4>

<p>
  ant里面的property的类型可以通过命令行的-Dname=value的方式指定参数,按这种方式指定的参数的优先级大于,ant的build.xml赋值的优先级.也即使说,会覆盖掉内部的缺省的变量值.
</p>

<h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
  条件测试
</h4>

<p>
  ant里面的条件测试可以用condition元素实现 当condition作为一个嵌套元素实现时,不支持属性操作,也就是说不能给其设施property属性,否则会出错. <br />当condition作为一个任务执行执行时,可以指定属性property,condtion会根据内部的逻辑计算的值,设置property指定的变量名称的变量. 那么这两个用起来有什么不同呢?
</p>

<ol>
  <li style="margin-bottom:5px;">
    对于第一种用法,一般来说时决定程序的执行流程中用的比较多.比如fail task,里面既可以用第一种方式指定在适当的时候结束任务.如下所示: <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">this is use for test whether the namespace propertiy is setted </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"testnamespace"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">fail</span> <span class="variable-name" style="color:rgb(153,0,255);">message</span>=<span class="string" style="color:rgb(0,153,0);">"ERROR:need namespace"</span> &gt;
      <span class="comment-delimiter">&lt;!--       </span><span class="comment" style="color:rgb(239,117,74);">&lt;condition property="namespace.available"&gt;  </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">not</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">isset</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"namespace"</span> /&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">not</span>&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">fail</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;</pre>
  </li>
  
  <li style="margin-bottom:5px;">
    对于第二种方法,主要用变量和条件的检测,进而控制某些步骤是否需要执行.如: <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"testShare"</span>&gt;
        &lt;<span class="function-name" style="color:rgb(102,51,255);">condition</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"share.available"</span>&gt;
            &lt;<span class="function-name" style="color:rgb(102,51,255);">isset</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"garshare.id"</span>/&gt;
        &lt;/<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
   <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">只有当测试为真的时候才执行这个任务 </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"copyShare"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"testShare"</span> <span class="variable-name" style="color:rgb(153,0,255);">if</span>=<span class="string" style="color:rgb(0,153,0);">"share.available"</span>&gt;
        &lt;<span class="function-name" style="color:rgb(102,51,255);">copy</span> <span class="variable-name" style="color:rgb(153,0,255);">todir</span>=<span class="string" style="color:rgb(0,153,0);">"${gar.dest}/share"</span>&gt;
            &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"${garshare.id}"</span>/&gt;
        &lt;/<span class="function-name" style="color:rgb(102,51,255);">copy</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;</pre>
  </li>
</ol>

<p>
  [<strong><em>note</em></strong>]:当然这不是绝对的,只是那种方式更自然一点的问题.仅供参考哟.
</p>

<h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
  arg
</h4>

<p>
  属性:
</p>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    file (all, File,*) 代表当前目录下的一个文件,用文件名作参数
  </li>
  <li style="margin-bottom:5px;">
    line (all,string,*) 一系列用空白分割的多个参数
  </li>
  <li style="margin-bottom:5px;">
    path (all,string,*) 一个路径,执行的时候,会被转化为基于操作系统的绝对路径
  </li>
  <li style="margin-bottom:5px;">
    value (all,string,*) 单个的commandline argument,如果你的参数中有空格,那么必须用这种方式指定<br /> <h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
      env
    </h4>
  </li>
</ul>

<ol>
  <li style="margin-bottom:5px;">
    属性:
  </li>
</ol>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    file(同上)
  </li>
  <li style="margin-bottom:5px;">
    key(all,string,Y) 环境变量的名称
  </li>
  <li style="margin-bottom:5px;">
    path (同上)
  </li>
  <li style="margin-bottom:5px;">
    value (同上)
  </li>
</ul>

<ol>
  <li style="margin-bottom:5px;">
    获取环境变量的另一种方好方式 <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">Set up the 'env' prefix for environment variables </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">environment</span>=<span class="string" style="color:rgb(0,153,0);">"env"</span>/&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"xalan.home"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"${env.XALAN_HOME}"</span>/&gt;
  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">Abort the build if XALAN_HOME is not set </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"checkXalanHome"</span> <span class="variable-name" style="color:rgb(153,0,255);">unless</span>=<span class="string" style="color:rgb(0,153,0);">"env.XALAN_HOME"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">fail</span> <span class="variable-name" style="color:rgb(153,0,255);">message</span>=<span class="string" style="color:rgb(0,153,0);">"XALAN_HOME must be set!"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;</pre>
  </li>
</ol>

<h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
  FileList
</h4>

<p>
  目的:用来支持一个文件列表,这些文件不一定存在
</p>

<ol>
  <li style="margin-bottom:5px;">
    属性:
  </li>
</ol>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    dir(file,*) 用于计算绝对路径的路径名
  </li>
  <li style="margin-bottom:5px;">
    files(string,*) 用逗号分割的文件名列表
  </li>
  <li style="margin-bottom:5px;">
    refif(Reference,*) 对于另一个=<a class="nonexistent" style="font-weight:bold;color:rgb(153,0,255);text-decoration:none;" href="mailto:liulikun@gmail.com">FileList</a>=的引用
  </li>
</ul>

<ol>
  <li style="margin-bottom:5px;">
    备注: FileList DataType主要是用来于dependset任务连用,实现文件的依赖性检查.当dependset里面定义的任何输入文件比输出文件新的话(或者输入文件被删除),所有的输出文件将被删除,以便重新生成. <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span>?&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"filelist demo"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"xslt"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">filelist</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"stylesheets"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>
          <span class="variable-name" style="color:rgb(153,0,255);">files</span>=<span class="string" style="color:rgb(0,153,0);">"header.xslt,footer.xslt,body.xslt"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">filelist</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"xmlfiles"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span> <span class="variable-name" style="color:rgb(153,0,255);">files</span>=<span class="string" style="color:rgb(0,153,0);">"employees.xml"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"xslt"</span>&gt;
      <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">erase employeeDirectory.html if any of the XML files or
       XSLT stylesheets are newer </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">dependset</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">srcfilelist</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"stylesheets"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">srcfilelist</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"xmlfiles"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">targetfilelist</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span> <span class="variable-name" style="color:rgb(153,0,255);">files</span>=<span class="string" style="color:rgb(0,153,0);">"employeeDirectory.html"</span>/&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">dependset</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">echo</span> <span class="variable-name" style="color:rgb(153,0,255);">message</span>=<span class="string" style="color:rgb(0,153,0);">"Transforming Files..."</span>/&gt;
      ...
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
  </li>
</ol>

<blockquote>
</blockquote>

<h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
  FileSet
</h4>

<p>
  目的:定义一系列文件的列表,该列表中的文件必须存在,给元素支持子元素的嵌套
</p>

<ol>
  <li style="margin-bottom:5px;">
    属性:
  </li>
</ol>

<ul style="list-style-type:disc;">
  <li style="margin-bottom:5px;">
    dir(path,Y) the base dir for the fileset
  </li>
  <li style="margin-bottom:5px;">
    casesencitive(boolean,N) 但为false时,在进行文件名的匹配的时候是不区分大小写的,默认情况下是区分大小写的.
  </li>
  <li style="margin-bottom:5px;">
    defaultexcludes(boolean,N) 从fileset中排除的文件.缺省为true,缺省排出的包括**/*~,<span class="Apple-converted-space">&#160;</span><strong>/#*#,<span class="Apple-converted-space">&#160;</span></strong>/.#*,<span class="Apple-converted-space">&#160;</span><strong>/%*%,<span class="Apple-converted-space">&#160;</span></strong>/CVS,<span class="Apple-converted-space">&#160;</span><strong>/CVS/</strong>,<span class="Apple-converted-space">&#160;</span><strong>/.cvsignore,</strong>/SCCS,<span class="Apple-converted-space">&#160;</span><strong>/SCCS/</strong>, and<span class="Apple-converted-space">&#160;</span><strong>/vssver.scc.</strong>
  </li>
  <p>
    <strong></p> 
    
    <li style="margin-bottom:5px;">
      excludes(string,N) 对于缺省排出的附加,一个用逗号分割的pattern串.
    </li>
    <li style="margin-bottom:5px;">
      excludefiles(string,N) 对于缺省排出的附加,The name of a file containing one exclude pattern per line.
    </li>
    <li style="margin-bottom:5px;">
      includes(string,N) 一个逗号分割的被包含的fileList
    </li>
    <p>
      </strong>
    </p>
    
    <li style="margin-bottom:5px;">
      <strong>includesfiles(files,N) The name of a file containing one include pattern per line. 2.例子: 下面的例子定义了一个fileset,递归包含目录src下的所有.java文件,但除去该目录树下所有test子树下的.java文件</strong> <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;"><strong>&lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"sources1"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>
     <span class="variable-name" style="color:rgb(153,0,255);">includes</span>=<span class="string" style="color:rgb(0,153,0);">"</span></strong>/*.java"
     <span class="variable-name" style="color:rgb(153,0,255);">excludes</span>=<span class="string" style="color:rgb(0,153,0);">"**/test/**/*.java"</span>&gt;
&lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt; </pre>
    </li></ul> 
    
    <p>
      等价于下面的例子
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"sources2"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">include</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.java"</span>/&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">exclude</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/test/**/*.java"</span>/&gt;
&lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt;</pre>
    
    <p>
      下面是一个fileset和patternset结合使用的例子
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"non.test.source"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">include</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.java"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">exclude</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/test/**/*.java"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">patternset</span>&gt;
  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">later in the same buildfile </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"sources4"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"non.test.source"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"sources5"</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"othersrc"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"non.test.source"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt;</pre>
    
    <blockquote>
      <h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
        PatternSet
      </h4>
    </blockquote>
    
    <ol>
      <li style="margin-bottom:5px;">
        目的: patternset使用和fileset连用,实现一系列文件的选择.pattern支持利用pattern来实现文件的include 和 exculde.他有四个属性,include,exclude,includefiles和excludefiles.每个属性又可以用name属性指定文件pattern,用if或unless属性指定条件.
      </li>
      <li style="margin-bottom:5px;">
        例子: <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"xml.files"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">include</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.dtd,**/*.xml,**/*.xslt"</span>/&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">patternset</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">copy</span> <span class="variable-name" style="color:rgb(153,0,255);">todir</span>=<span class="string" style="color:rgb(0,153,0);">"${deploy.dir}"</span>&gt;
      <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">select the files to copy </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"${src.dir}"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"${xml.files}"</span>/&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">copy</span>&gt;
  </pre>
      </li>
    </ol>
    
    <p>
      下面是另一个例子,该例子中我们排出了所有的测试单元,除非设置了includetests变量
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span>?&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"patternset_test_project"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"compile"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>&gt;
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">exclude tests unless the 'includetests' property is set </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"sources"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">include</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.java"</span>/&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">exclude</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*Test.java"</span> <span class="variable-name" style="color:rgb(153,0,255);">unless</span>=<span class="string" style="color:rgb(0,153,0);">"includetests"</span>/&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">patternset</span>&gt;
    ...remainder of buildfile omitted
    &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"compile"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"prepare"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">javac</span> <span class="variable-name" style="color:rgb(153,0,255);">destdir</span>=<span class="string" style="color:rgb(0,153,0);">"build"</span>&gt;
    <span class="comment-delimiter">&lt;!--</span><span class="comment" style="color:rgb(239,117,74);">the directory from which the patternset finds files to compile</span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">src</span> <span class="variable-name" style="color:rgb(153,0,255);">path</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>/&gt;
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">refer to the patternset which selects the source files </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">patternset</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"sources"</span>/&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">javac</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
      FilterSet
    </h4>
    
    <ol>
      <li style="margin-bottom:5px;">
        目的:移动或者拷贝文件的时候的,对文件的内容进行替换.该datatype具有如下属性:begintoken,endtoken,id,refid等,内部可以嵌套如下子元素:
      </li>
    </ol>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        filter: 有两个属性:name,知道要替代的token的名字,value:指定替代值.可用变量
      </li>
      <li style="margin-bottom:5px;">
        filtersfile: 用于指定一个java properties文件,利用该文件的属性名值对进行替换.有一个必要的属性:file,指定属性文件名.
      </li>
    </ul>
    
    <ol>
      <li style="margin-bottom:5px;">
        例子: 这是在拷贝文件的时候,对于文件的版权和创建时间进行替换的例子. <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"tokenFilterDemo"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"prepare"</span>&gt;
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">set up the timestamp </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">tstamp</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">format</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"now"</span> <span class="variable-name" style="color:rgb(153,0,255);">pattern</span>=<span class="string" style="color:rgb(0,153,0);">"MMMM d yyyy hh:mm aa"</span>/&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">tstamp</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">copy</span> <span class="variable-name" style="color:rgb(153,0,255);">todir</span>=<span class="string" style="color:rgb(0,153,0);">"build"</span> <span class="variable-name" style="color:rgb(153,0,255);">filtering</span>=<span class="string" style="color:rgb(0,153,0);">"true"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">include</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.java"</span>/&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">fileset</span>&gt;
      <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">search for %COPYRIGHT! and %BUILD_DATE! </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">filterset</span> <span class="variable-name" style="color:rgb(153,0,255);">begintoken</span>=<span class="string" style="color:rgb(0,153,0);">"%"</span> <span class="variable-name" style="color:rgb(153,0,255);">endtoken</span>=<span class="string" style="color:rgb(0,153,0);">"!"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">filter</span> <span class="variable-name" style="color:rgb(153,0,255);">token</span>=<span class="string" style="color:rgb(0,153,0);">"BUILD_DATE"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"${now}"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">filter</span> <span class="variable-name" style="color:rgb(153,0,255);">token</span>=<span class="string" style="color:rgb(0,153,0);">"COPYRIGHT"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"Copyright (C) 2002 O'Reilly"</span>/&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">filterset</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">copy</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;</pre>
      </li>
    </ol>
    
    <h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
      Path
    </h4>
    
    <ol>
      <li style="margin-bottom:5px;">
        目的:代表文件和路径,主要用于表示classpath之类的东西.可以作为一个属性使用.当用作属性的时候,path的entry用";"或者":"分割.当作为datatype使用的时候支持以下属性:
      </li>
    </ol>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        location: 代表单个的文件或者目录,ant将其扩充成绝对路径
      </li>
      <li style="margin-bottom:5px;">
        path: 一系列用;或:分割的文件或目录名
      </li>
      <li style="margin-bottom:5px;">
        refid:这个不用说了把. 支持以下嵌套的子元素:
      </li>
      <li style="margin-bottom:5px;">
        pathelement: 定义一个或者多个被包含进改路径的文件.该子元素也支持location和path属性
      </li>
      <li style="margin-bottom:5px;">
        fileset: 另一种将文件和路径包含进path的语法
      </li>
      <li style="margin-bottom:5px;">
        path:用于路径的嵌套
      </li>
    </ul>
    
    <ol>
      <li style="margin-bottom:5px;">
        例子: 定义一个包含两个jar文件和两个目录的path元素 <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="function-name" style="color:rgb(102,51,255);">path</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">pathelement</span> <span class="variable-name" style="color:rgb(153,0,255);">location</span>=<span class="string" style="color:rgb(0,153,0);">"${libdir}/servlet.jar"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">pathelement</span> <span class="variable-name" style="color:rgb(153,0,255);">location</span>=<span class="string" style="color:rgb(0,153,0);">"${libdir}/logging.jar"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">pathelement</span> <span class="variable-name" style="color:rgb(153,0,255);">path</span>=<span class="string" style="color:rgb(0,153,0);">"${builddir}"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">pathelement</span> <span class="variable-name" style="color:rgb(153,0,255);">path</span>=<span class="string" style="color:rgb(0,153,0);">"${utilpath}"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">path</span>&gt;</pre>
      </li>
    </ol>
    
    <p>
      下面是定义classpath的两种等价的方法
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">The classpath element is implemented with the path DataType </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">classpath</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">pathelement</span> <span class="variable-name" style="color:rgb(153,0,255);">path</span>=<span class="string" style="color:rgb(0,153,0);">"${builddir}"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">classpath</span>&gt;</pre>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">  &lt;<span class="function-name" style="color:rgb(102,51,255);">classpath</span> <span class="variable-name" style="color:rgb(153,0,255);">path</span>=<span class="string" style="color:rgb(0,153,0);">"${builddir}"</span>/&gt;</pre>
    
    <h4 style="border-right:rgb(102,102,102) 3px solid;padding-right:6px;border-top:rgb(190,190,190) 1px solid;margin-top:15px;padding-left:6px;margin-bottom:15px;border-left:rgb(102,102,102) 3px solid;border-bottom:rgb(190,190,190) 1px solid;background-color:rgb(255,204,153);">
      Mapper
    </h4>
    
    <ol>
      <li style="margin-bottom:5px;">
        目的:主要用于指定操作的源文件和目标文件的相关性. 主要有以下属性:
      </li>
    </ol>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        classname: 实现mapper的类名.
      </li>
      <li style="margin-bottom:5px;">
        classpath: 查找自定义mapper的类路径,改路径将被附加到系统的classpath中进行搜索
      </li>
      <li style="margin-bottom:5px;">
        classpathref:引用一个定义的classpath
      </li>
      <li style="margin-bottom:5px;">
        from: 操作的源
      </li>
      <li style="margin-bottom:5px;">
        refid: 不用说了把
      </li>
      <li style="margin-bottom:5px;">
        to:操作的目标
      </li>
      <li style="margin-bottom:5px;">
        type: 指定mapper的类型,这个很重要的.
      </li>
    </ul>
    
    <ol>
      <li style="margin-bottom:5px;">
        例子: <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">Example 4-2. Backing up files with a glob mapper
&lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span>?&gt;
&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"mapper demo"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"backupFiles"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>&gt;
  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">define a mapper for backing up files </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"backupMapper"</span> <span class="variable-name" style="color:rgb(153,0,255);">type</span>=<span class="string" style="color:rgb(0,153,0);">"glob"</span> <span class="variable-name" style="color:rgb(153,0,255);">from</span>=<span class="string" style="color:rgb(0,153,0);">"*.java"</span> <span class="variable-name" style="color:rgb(153,0,255);">to</span>=<span class="string" style="color:rgb(0,153,0);">"*.java.bak"</span>/&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"clean"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">delete</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"bak"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"prepare"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">mkdir</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"bak"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"backupFiles"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"prepare"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">copy</span> <span class="variable-name" style="color:rgb(153,0,255);">todir</span>=<span class="string" style="color:rgb(0,153,0);">"bak"</span>&gt;
      <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">select the files to copy with a fileset </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span> <span class="variable-name" style="color:rgb(153,0,255);">includes</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.java"</span>/&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">refid</span>=<span class="string" style="color:rgb(0,153,0);">"backupMapper"</span>/&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">copy</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
      </li>
      
      <li style="margin-bottom:5px;">
        mapper的类型: 主要有以下几种类型:identity, flatten, glob, merge, or regexp.下面一一介绍:
      </li>
    </ol>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        identity mapper maps the source files and the target files with the same name. <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">type</span>=<span class="string" style="color:rgb(0,153,0);">"identity"</span>/&gt;</pre>
      </li>
    </ul>
    
    <p>
      Table Identity mapper result
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <th>
          source file
        </th>
        
        <th>
          target file
        </th>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          Customer.java
        </td>
        
        <td>
          Customer.java
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          com/oreilly/ant/Account.java
        </td>
        
        <td>
          com/oreilly/ant/Account.java
        </td>
      </tr>
    </table>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        flatten mapper removes all the path imformation from files.这在拷贝多个文件到一个目录中时很有用. <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">type</span>=<span class="string" style="color:rgb(0,153,0);">"flatten"</span>/&gt;</pre>
      </li>
    </ul>
    
    <p>
      map result:
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <th>
          Source file
        </th>
        
        <th>
          Target file
        </th>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          Customer.java
        </td>
        
        <td>
          Customer.java
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          com/oreilly/data/Account.java
        </td>
        
        <td>
          Account.java
        </td>
      </tr>
    </table>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        glob mapper The glob mapper determines target filenames based on simple wildcard patterns. This is useful when you want to rename groups of files that already have consistent filenames <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">type</span>=<span class="string" style="color:rgb(0,153,0);">"glob"</span> <span class="variable-name" style="color:rgb(153,0,255);">from</span>=<span class="string" style="color:rgb(0,153,0);">"*Test.java"</span> <span class="variable-name" style="color:rgb(153,0,255);">to</span>=<span class="string" style="color:rgb(0,153,0);">"*UnitTest.java"</span>&gt;</pre>
      </li>
    </ul>
    
    <p>
      map result:
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <th>
          Source file
        </th>
        
        <th>
          Target file
        </th>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          Customer.java
        </td>
        
        <td>
          none
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          com/oreilly/data/Account.java
        </td>
        
        <td>
          none
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          <a class="nonexistent" style="font-weight:bold;color:rgb(153,0,255);text-decoration:none;" href="mailto:liulikun@gmail.com">CustomerTest</a>.java
        </td>
        
        <td>
          CustomerUnitTest.java
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          com/oreilly/tests/CustomerTest.java
        </td>
        
        <td>
          com/oreilly/tests/CustomerUnitTest.java
        </td>
      </tr>
    </table>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        merge mapper The merge mapper maps any set of source filenames to the same target filename, as specified by the to attribute. The from attribute is ignored. The merge mapper is useful when you want to compare timestamps of a set of source files against a single target file. <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1078px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">mapper</span> <span class="variable-name" style="color:rgb(153,0,255);">type</span>=<span class="string" style="color:rgb(0,153,0);">"merge"</span> <span class="variable-name" style="color:rgb(153,0,255);">to</span>=<span class="string" style="color:rgb(0,153,0);">"oreilly.zip"</span>&gt;</pre>
      </li>
    </ul>
    
    <p>
      map result:
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <th>
          Source file
        </th>
        
        <th>
          Target file
        </th>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          Customer.java
        </td>
        
        <td>
          oreilly.zip
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          com/oreilly/data/Account.java
        </td>
        
        <td>
          oreilly.zip
        </td>
      </tr>
    </table>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        regxp mapper 与glob类似,出了用正则表达式代替了简单的*之外,但该mapper的结果依赖于底层(underlying)的正则表达式的实现
      </li>
    </ul>
    
    <h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
      自定义任务
    </h3>
    
    <p>
      你可以通过改ant的ant.jar里面的default.properities文件来给ant正加新的任务,但这需要重新编译ant.推荐的方式是在build.xml终进行任务的定义.例如:
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">taskdef</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"jar"</span> <span class="variable-name" style="color:rgb(153,0,255);">classname</span>=<span class="string" style="color:rgb(0,153,0);">"org.apache.tools.ant.taskdefs.Jar"</span>/&gt;</pre>
    
    <h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
      Use listener
    </h3>
    
    <p>
      给ant正加listener,可以将listener打成jar包,放在ANT_HOME/lib目录下,然后指定参数 -listener listenerClass
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">ant -listener org.apache.tools.ant.&lt;<span class="function-name" style="color:rgb(102,51,255);">nop</span>&gt;XmlLogger</pre>
    
    <blockquote>
    </blockquote>
    
    <h2 style="border-right:rgb(102,102,102) 2px solid;border-top:rgb(0,102,153) 1px solid;border-left:rgb(0,153,204) 1px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(210,233,255);margin:20px -30px 10px;padding:0 5px;">
      Task
    </h2>
    
    <h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
      <a id="echo" style="font-weight:bold;color:rgb(102,102,102);text-decoration:none;"></a>echo
    </h3>
    
    <p>
      this is the simplest test. 可以向一个文件或者标准控制台写入一个字符串. 其中写入的字符窜以message属性指定或者卸载元素中间的text section.
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td valign="top" align="left">
          <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
            <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
              <td>
                ttribute
              </td>
              
              <td>
                &#160;&#160;&#160; Description&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
              </td>
              
              <td>
                Required&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
              </td>
            </tr>
          </table>
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td valign="top" align="left">
          <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
            <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
              <td>
                message&#160;
              </td>
              
              <td>
                &#160;&#160;&#160; the message to echo.&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
              </td>
              
              <td>
                Yes, unless data is included in a character section within this element.&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    
    <p>
      下面是这个task的几个例子
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">echo</span> <span class="variable-name" style="color:rgb(153,0,255);">file</span>=<span class="string" style="color:rgb(0,153,0);">"runner.csh"</span> <span class="variable-name" style="color:rgb(153,0,255);">append</span>=<span class="string" style="color:rgb(0,153,0);">"false"</span>&gt;#!/bin/tcsh
java-1.3.1 -mx1024m ${project.entrypoint} $$*
&lt;/<span class="function-name" style="color:rgb(102,51,255);">echo</span>&gt;</pre>
    
    <p>
      Generate a shell script by echoing to a file. Note the use of a double $ symbol to stop Ant filtering out the single $ during variable expansion
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">echo</span> <span class="variable-name" style="color:rgb(153,0,255);">level</span>=<span class="string" style="color:rgb(0,153,0);">"error"</span>&gt;
Imminent failure in the antimatter containment facility.${line.separator}
Please withdraw to safe location at least 50km away.
&lt;/<span class="function-name" style="color:rgb(102,51,255);">echo</span>&gt;</pre>
    
    <p>
      里面可以使用变量,比如${line.separator},里面的文本元素会照原样输出.
    </p>
    
    <h3 style="border-right:rgb(153,153,153) 6px solid;padding-right:6px;border-top:rgb(0,102,0) 1px solid;margin-top:20px;padding-left:5px;margin-bottom:10px;border-left:rgb(204,204,204) 6px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(233,252,238);">
      script
    </h3>
    
    <p>
      这个task比较有意思.她能够使你在task内写一段脚本代码.然后执行之. 参数:
    </p>
    
    <table style="background-color:rgb(255,102,0);" cellspacing="1" cellpadding="3" align="center" border="0">
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <th>
          Attribute
        </th>
        
        <th>
          Description
        </th>
        
        <th>
          Required
        </th>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          language
        </td>
        
        <td>
          The programming language the script is written in. Must be a supported Apache BSF language
        </td>
        
        <td>
          Yes
        </td>
      </tr>
      
      <tr style="font-size:9pt;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/bg_old.gif');text-decoration:none;">
        <td>
          src
        </td>
        
        <td>
          The location of the script as a file, if not inline
        </td>
        
        <td>
          No
        </td>
      </tr>
    </table>
    
    <p>
      下面是几个简单的例子:
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"squares"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"setup"</span>&gt;

    &lt;<span class="function-name" style="color:rgb(102,51,255);">script</span> <span class="variable-name" style="color:rgb(153,0,255);">language</span>=<span class="string" style="color:rgb(0,153,0);">"javascript"</span>&gt; &lt;![CDATA[

      for (i=1; i&lt;=10; i++) {
        echo = squares.createTask(<span class="string" style="color:rgb(0,153,0);">"echo"</span>);
        main.addTask(echo);
        echo.setMessage(i*i);
      }

    ]]&gt; &lt;/<span class="function-name" style="color:rgb(102,51,255);">script</span>&gt;

  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"setup"</span>/&gt;

&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <p>
      输出:
    </p>
    
    <pre class="example" style="border-right:rgb(255,204,0) 1px solid;border-top:rgb(255,204,0) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(255,204,0) 1px solid;width:1114px;color:rgb(0,102,0);border-bottom:rgb(255,204,0) 1px solid;background-color:rgb(196,230,240);margin:10px 10px 2.5em;padding:10px;">setup:

main:
1
4
9
16
25
36
49
64
81
100

BUILD SUCCESSFUL</pre>
    
    <p>
      另一个例子:
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"testscript"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"sub"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">echo</span> <span class="variable-name" style="color:rgb(153,0,255);">id</span>=<span class="string" style="color:rgb(0,153,0);">"theEcho"</span>/&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"sub1"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">script</span> <span class="variable-name" style="color:rgb(153,0,255);">language</span>=<span class="string" style="color:rgb(0,153,0);">"netrexx"</span>&gt;&lt;![CDATA[
      theEcho.setMessage(<span class="string" style="color:rgb(0,153,0);">"In sub1"</span>)
      sub.execute
    ]]&gt;&lt;/<span class="function-name" style="color:rgb(102,51,255);">script</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"sub2"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">script</span> <span class="variable-name" style="color:rgb(153,0,255);">language</span>=<span class="string" style="color:rgb(0,153,0);">"javascript"</span>&gt;&lt;![CDATA[
      theEcho.setMessage(<span class="string" style="color:rgb(0,153,0);">"In sub2"</span>);
      sub.execute();
    ]]&gt;&lt;/<span class="function-name" style="color:rgb(102,51,255);">script</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"sub1,sub2"</span>/&gt;
&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <pre class="example" style="border-right:rgb(255,204,0) 1px solid;border-top:rgb(255,204,0) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(255,204,0) 1px solid;width:1114px;color:rgb(0,102,0);border-bottom:rgb(255,204,0) 1px solid;background-color:rgb(196,230,240);margin:10px 10px 2.5em;padding:10px;">generates

sub1:
In sub1

sub2:
In sub2

main:

BUILD SUCCESSFUL</pre>
    
    <p>
      a more complex example:
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span> <span class="variable-name" style="color:rgb(153,0,255);">encoding</span>=<span class="string" style="color:rgb(0,153,0);">"ISO-8859-1"</span>?&gt;
<span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">Now a more complex example using the Java API and the Ant API. The goal is to list the filesizes of all files a &lt;fileset/&gt; caught. </span><span class="comment-delimiter">--&gt;</span>
&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"MyProject"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span>&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"fs.dir"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"src"</span>/&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"fs.includes"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.txt"</span>/&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"fs.excludes"</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"**/*.tmp"</span>/&gt;

  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">script</span> <span class="variable-name" style="color:rgb(153,0,255);">language</span>=<span class="string" style="color:rgb(0,153,0);">"javascript"</span>&gt; &lt;![CDATA[

      // import statements
      // importPackage(java.io);
      importClass(java.io.File);

      // Access to Ant-Properties by their names
      dir      = project.getProperty(<span class="string" style="color:rgb(0,153,0);">"fs.dir"</span>);
      includes = MyProject.getProperty(<span class="string" style="color:rgb(0,153,0);">"fs.includes"</span>);
      excludes = self.getProject()  .getProperty(<span class="string" style="color:rgb(0,153,0);">"fs.excludes"</span>);

      // Create a &lt;<span class="function-name" style="color:rgb(102,51,255);">fileset</span> <span class="variable-name" style="color:rgb(153,0,255);">dir</span>=<span class="string" style="color:rgb(0,153,0);">""</span> <span class="variable-name" style="color:rgb(153,0,255);">includes</span>=<span class="string" style="color:rgb(0,153,0);">""</span> /&gt;
      fs = project.createDataType(<span class="string" style="color:rgb(0,153,0);">"fileset"</span>);
      fs.setDir( new File(dir) );
      fs.setIncludes(includes);
      fs.setExcludes(excludes);

      // Get the files (array) of that fileset
      ds = fs.getDirectoryScanner(project);
      srcFiles = ds.getIncludedFiles();

      // iterate over that array
      for (i=0; i&lt;<span class="function-name" style="color:rgb(102,51,255);">srcFiles.length</span>; i++) {

        // get the values via Java API
        var basedir  = fs.getDir(project);
        var filename = srcFiles[i];
        var file = new File(basedir, filename);
        var size = file.length();

        // create and use a Task via Ant API
        echo = MyProject.createTask(<span class="string" style="color:rgb(0,153,0);">"echo"</span>);
        echo.setMessage(filename + <span class="string" style="color:rgb(0,153,0);">": "</span> + size + <span class="string" style="color:rgb(0,153,0);">" byte"</span>);
        echo.perform();
      }
    ]]&gt;&lt;/<span class="function-name" style="color:rgb(102,51,255);">script</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;
&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <p>
      下面时我写的一个ant脚本,用来根据一个url生成对应的globus的namespace2package.mappings文件.
    </p>
    
    <p>
      要运行该脚本请保证你安装了ant的bsf.jar扩展和js.jar扩展.可以到<a style="font-weight:bold;color:rgb(204,51,0);text-decoration:none;" href="http://jakarta.apache.org/bsf/">http://jakarta.apache.org/bsf/</a><span class="Apple-converted-space">&#160;</span>和<span class="Apple-converted-space">&#160;</span><a style="font-weight:bold;color:rgb(204,51,0);text-decoration:none;" href="http://www.mozilla.org/rhino/">http://www.mozilla.org/rhino/</a><span class="Apple-converted-space">&#160;</span>两个地方区下载响应的软件包
    </p>
    
    <p>
      这个脚本有两个参数:
    </p>
    
    <ul style="list-style-type:disc;">
      <li style="margin-bottom:5px;">
        -Dnamespace (required) : this is the namespace to be tranlated, such as :<span class="Apple-converted-space">&#160;</span><a style="font-weight:bold;color:rgb(204,51,0);text-decoration:none;" href="http://www.chinagrid.edu.cn/WelcomeService/Welcome">http://www.chinagrid.edu.cn/WelcomeService/Welcome</a>
      </li>
      <li style="margin-bottom:5px;">
        -DemptyMappings (optional) : if you want the script empty the old mapping, set the this<span class="Apple-converted-space">&#160;</span><em>true</em>; [<strong><em>note</em></strong>]: this script will omint the<span class="Apple-converted-space">&#160;</span><em>www</em><span class="Apple-converted-space">&#160;</span>prefix, that means the "http://www.chinagrid.edu.cn/WelcomeService/Welcome" will be tranlated into the pacakge "cn.edu.chinagrid.WelcomeService.Welcome"
      </li>
    </ul>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span> <span class="variable-name" style="color:rgb(153,0,255);">encoding</span>=<span class="string" style="color:rgb(0,153,0);">"ISO-8859-1"</span>?&gt;
&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"squares"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span> <span class="variable-name" style="color:rgb(153,0,255);">basedir</span>=<span class="string" style="color:rgb(0,153,0);">"."</span>&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">description</span>&gt;
    GSBT GT4 buildfile
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">description</span>&gt;

  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">Define the environment variable </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">environment</span>=<span class="string" style="color:rgb(0,153,0);">"env"</span> /&gt;

  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">
       Properties in these files will override the properties defined in this file.
    </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">file</span>=<span class="string" style="color:rgb(0,153,0);">"build.properties"</span> /&gt;
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">file</span>=<span class="string" style="color:rgb(0,153,0);">"${user.home}/build.properties"</span> /&gt;


  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">translate the  namespace to package in this file  </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"mappings.file"</span>    <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"${basedir}/namespace2package.mappings"</span> /&gt;


  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">this is use for test whether the namespace propertiy is setted </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"testnamespace"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">fail</span> <span class="variable-name" style="color:rgb(153,0,255);">message</span>=<span class="string" style="color:rgb(0,153,0);">"ERROR:need namespace"</span> &gt;
      <span class="comment-delimiter">&lt;!--       </span><span class="comment" style="color:rgb(239,117,74);">&lt;condition property="namespace.available"&gt;  </span><span class="comment-delimiter">--&gt;</span>
      &lt;<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">not</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">isset</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"namespace"</span> /&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">not</span>&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">fail</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">test whether the mapping need to be empty </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"testEmpty"</span> &gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">condition</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"needEmptyMappings"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">and</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">isset</span> <span class="variable-name" style="color:rgb(153,0,255);">property</span>=<span class="string" style="color:rgb(0,153,0);">"emptyMappings"</span>/&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">istrue</span> <span class="variable-name" style="color:rgb(153,0,255);">value</span>=<span class="string" style="color:rgb(0,153,0);">"${emptyMappings}"</span> /&gt;
      &lt;/<span class="function-name" style="color:rgb(102,51,255);">and</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">condition</span>&gt;
  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;


  <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">generate  the namespace2package.mappings file  </span><span class="comment-delimiter">--&gt;</span>
  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"generateNamespace2PackageMapping"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"testnamespace,testEmpty"</span>  <span class="variable-name" style="color:rgb(153,0,255);">description</span>=<span class="string" style="color:rgb(0,153,0);">"creat the base directory structure"</span>&gt;
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">&lt;echo file="${mappings.file}" append="false"&gt;ok${line.separator}&lt;/echo&gt; </span><span class="comment-delimiter">--&gt;</span>
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">&lt;echo file="${mappings.file}" append="true"&gt;hehe${mappings.file}&lt;/echo&gt; </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">script</span> <span class="variable-name" style="color:rgb(153,0,255);">language</span>=<span class="string" style="color:rgb(0,153,0);">"javascript"</span>&gt; &lt;![CDATA[

      var namespace= project.getProperty(<span class="string" style="color:rgb(0,153,0);">"namespace"</span>);
      //var s1= new java.lang.String(<span class="string" style="color:rgb(0,153,0);">"http://www.chinagrid.edu.cn/WelcomeService/Welcome"</span>);
      if(namespace.charAt(namespace.length()-1) == '/' ) namespace=namespace.substring(0,namespace.length()-1);
      var s1= new java.lang.String(namespace);
      //      var s2=s1.replaceFirst(<span class="string" style="color:rgb(0,153,0);">"http://.*?/"</span>,<span class="string" style="color:rgb(0,153,0);">""</span>).replace(<span class="string" style="color:rgb(0,153,0);">"/"</span>,<span class="string" style="color:rgb(0,153,0);">"."</span>);

      //delete the url's  prefix, such as <span class="string" style="color:rgb(0,153,0);">"http://"</span>, <span class="string" style="color:rgb(0,153,0);">"https"</span>,<span class="string" style="color:rgb(0,153,0);">"ftp://"</span> etc.
      if(s1.startsWith(<span class="string" style="color:rgb(0,153,0);">"http://"</span>)) s1=s1.substring(7);
      else if(s1.startsWith(<span class="string" style="color:rgb(0,153,0);">"ftp://"</span>)) s1=s1.substring(6);
      else if(s1.startsWith(<span class="string" style="color:rgb(0,153,0);">"https://"</span>)) s1=s1.substring(8);

      //devide the string at the firt <span class="string" style="color:rgb(0,153,0);">"/"</span>
      // ex: www.chinagrid.edu.cn/WelcomeService/Welcome =&gt; <span class="string" style="color:rgb(0,153,0);">"www.chinagrid.edu.cn"</span> <span class="string" style="color:rgb(0,153,0);">"WelcomeSevice/Welcome"</span>
      var i=s1.indexOf('/');
      var <span class="variable-name" style="color:rgb(153,0,255);">s2</span>=<span class="string" style="color:rgb(0,153,0);">""</span>;
      var <span class="variable-name" style="color:rgb(153,0,255);">s3</span>=<span class="string" style="color:rgb(0,153,0);">""</span>;
      if( i != -1 ) {
          s2=s1.substring(i+1).replace('/','.');
          s3=s1.substring(0,i);
      }

      //reserve the domain name and delete the <span class="string" style="color:rgb(0,153,0);">"www"</span> prefix:
      //ex: www.chinagrid.edu.cn =&gt; <span class="string" style="color:rgb(0,153,0);">"cn.edu.chiangrid"</span>
      var stack=new java.util.Stack();
      var st=new java.util.StringTokenizer(s3,<span class="string" style="color:rgb(0,153,0);">"."</span>);
      while(st.hasMoreTokens()){
         stack.push(st.nextToken());
      }
      var sb=new java.lang.StringBuffer();
      sb.append(stack.pop());
      while ( ! stack.empty() ){
         s3=stack.pop();
         if( !s3.equals( <span class="string" style="color:rgb(0,153,0);">"www"</span> ) ) {
            sb.append('.');
            sb.append(s3);
         }
      }

      //get the whole package name
      // cn.edu.chiangrid.WelcomeService.Welcome
      if(s2 != <span class="string" style="color:rgb(0,153,0);">""</span>){
         sb.append('.');
         sb.append(s2);
      }
      s3 = sb.toString();

      //convert the <span class="string" style="color:rgb(0,153,0);">"http://"</span> =&gt; <span class="string" style="color:rgb(0,153,0);">"http://"</span>,
      // do thsi bicause the properties file trade the <span class="string" style="color:rgb(0,153,0);">":"</span> as a special char
      namespace=namespace.replaceAll(<span class="string" style="color:rgb(0,153,0);">":"</span>,<span class="string" style="color:rgb(0,153,0);">"\\:"</span>);


      //create the echo task
      mappingFile = project.getProperty(<span class="string" style="color:rgb(0,153,0);">"mappings.file"</span>);
      lineEnd = project.getProperty(<span class="string" style="color:rgb(0,153,0);">"line.separator"</span>);
      emptyMap= project.getProperty(<span class="string" style="color:rgb(0,153,0);">"needEmptyMappings"</span>);
      echo = project.createTask(<span class="string" style="color:rgb(0,153,0);">"echo"</span>);
      if(emptyMap) echo.setAppend(false);
      else echo.setAppend(true);
      //main.addTask(echo);
      //set the file for echo task
      var file=new java.io.File(mappingFile);
      echo.setFile(file);
      echo.setMessage(namespace+<span class="string" style="color:rgb(0,153,0);">"="</span>+s3+<span class="string" style="color:rgb(0,153,0);">".stubs"</span>+lineEnd);
      echo.perform();
      //      echo.setMessage(mappingFile);
      echo.setAppend(true);
      echo.setMessage(namespace+<span class="string" style="color:rgb(0,153,0);">"/bindings="</span>+s3+<span class="string" style="color:rgb(0,153,0);">".stubs.bindings"</span>+lineEnd);
      echo.perform();
      echo.setMessage(namespace+<span class="string" style="color:rgb(0,153,0);">"/service="</span>+s3+<span class="string" style="color:rgb(0,153,0);">".stubs.service"</span>+lineEnd);
      echo.perform();

    ]]&gt; &lt;/<span class="function-name" style="color:rgb(102,51,255);">script</span>&gt;


  &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;


  &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"main"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"generateNamespace2PackageMapping"</span>/&gt;

&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <h2 style="border-right:rgb(102,102,102) 2px solid;border-top:rgb(0,102,153) 1px solid;border-left:rgb(0,153,204) 1px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(210,233,255);margin:20px -30px 10px;padding:0 5px;">
      属性的覆盖
    </h2>
    
    <p>
      ant 可以通过指定一个属性文件,覆盖掉ant里面定义的属性,这和命令行方式是一样的.ant默认采用的java个格式的属性文件.请看下面的示例
    </p>
    
    <pre class="source" style="border-right:rgb(119,119,119) 1px solid;border-top:rgb(119,119,119) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(119,119,119) 1px solid;width:1114px;color:rgb(40,77,106);border-bottom:rgb(119,119,119) 1px solid;background-color:rgb(196,230,240);margin:10px;padding:10px;">&lt;<span class="keyword" style="color:rgb(51,102,0);">?xml</span> <span class="variable-name" style="color:rgb(153,0,255);">version</span>=<span class="string" style="color:rgb(0,153,0);">"1.0"</span>?&gt;
<span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">======================================================================
     2005-7-25 14:07:18
     file: a.xml
     project: project
     description : description

     author: Liu Likun
     ====================================================================== </span><span class="comment-delimiter">--&gt;</span>
&lt;<span class="function-name" style="color:rgb(102,51,255);">project</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"project"</span> <span class="variable-name" style="color:rgb(153,0,255);">default</span>=<span class="string" style="color:rgb(0,153,0);">"all"</span>&gt;
    &lt;<span class="function-name" style="color:rgb(102,51,255);">description</span>&gt;
            description
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">description</span>&gt;

    &lt;<span class="function-name" style="color:rgb(102,51,255);">property</span> <span class="variable-name" style="color:rgb(153,0,255);">file</span>=<span class="string" style="color:rgb(0,153,0);">"b.properities"</span> /&gt;
    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">=================================
          target: all
         ================================= </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"all"</span> <span class="variable-name" style="color:rgb(153,0,255);">depends</span>=<span class="string" style="color:rgb(0,153,0);">"init"</span> <span class="variable-name" style="color:rgb(153,0,255);">description</span>=<span class="string" style="color:rgb(0,153,0);">"--&gt; description"</span>&gt;
      &lt;<span class="function-name" style="color:rgb(102,51,255);">echo</span> <span class="variable-name" style="color:rgb(153,0,255);">message</span>=<span class="string" style="color:rgb(0,153,0);">"${msg}"</span> /&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

    <span class="comment-delimiter">&lt;!-- </span><span class="comment" style="color:rgb(239,117,74);">- - - - - - - - - - - - - - - - -
          target: init
         - - - - - - - - - - - - - - - - - </span><span class="comment-delimiter">--&gt;</span>
    &lt;<span class="function-name" style="color:rgb(102,51,255);">target</span> <span class="variable-name" style="color:rgb(153,0,255);">name</span>=<span class="string" style="color:rgb(0,153,0);">"init"</span>&gt;
    &lt;/<span class="function-name" style="color:rgb(102,51,255);">target</span>&gt;

&lt;/<span class="function-name" style="color:rgb(102,51,255);">project</span>&gt;</pre>
    
    <p>
      下面是b.properties的内容
    </p>
    
    <pre class="example" style="border-right:rgb(255,204,0) 1px solid;border-top:rgb(255,204,0) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(255,204,0) 1px solid;width:1114px;color:rgb(0,102,0);border-bottom:rgb(255,204,0) 1px solid;background-color:rgb(196,230,240);margin:10px 10px 2.5em;padding:10px;">msg=hehe world n welcome to ant world </pre>
    
    <p>
      下面是ant的输出:
    </p>
    
    <pre class="example" style="border-right:rgb(255,204,0) 1px solid;border-top:rgb(255,204,0) 1px solid;background-image:url('http://grid.tsinghua.edu.cn/home/liulk/wiki/images/css-default/nice.gif');font:9pt monospace, &#039;border-left:rgb(255,204,0) 1px solid;width:1114px;color:rgb(0,102,0);border-bottom:rgb(255,204,0) 1px solid;background-color:rgb(196,230,240);margin:10px 10px 2.5em;padding:10px;">h:/development/project/eclipseroot/testbuild # ant -file a.xml
Buildfile: a.xml

init:

all:
     [echo] hehe world
     [echo]  welcome to ant world

BUILD SUCCESSFUL
Total time: 0 seconds</pre>
    
    <h2 style="border-right:rgb(102,102,102) 2px solid;border-top:rgb(0,102,153) 1px solid;border-left:rgb(0,153,204) 1px solid;border-bottom:rgb(112,128,144) 2px solid;background-color:rgb(210,233,255);margin:20px -30px 10px;padding:0 5px;">
      ant表示一个目录和这个目录下所有的文件
    </h2>
    
    <p>
      dir/**/*.java 表示dir目录及其子目录下所有的.java文件.
    </p>
    
    <p>
      <strong>/*.java <=> ./</strong>/*.java当前目录及其子目录下所有的.java文件</span></span>
    </p>
    
    <p>
      转载请注明：<a href="http://www.beansoft.biz">WebLogic Android 博客</a> &raquo; <a href="http://www.beansoft.biz/2010/12/05/ant-%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%e8%bd%ac/">ant 的学习笔记[转]</a>
    </p>